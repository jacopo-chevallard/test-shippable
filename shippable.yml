language: none


integrations:                              
    hub:
      - integrationName: Docker-jc
        type: docker                        

#branches:
#  only:
#    - master

#compiler:
#  - gcc

# environment variable
env:
  - CMAKE_MACROS=$HOME/cmake-macros INSTALL_DIR=$HOME/install

build:

  pre_ci_boot:
    image_name: jacopochevallard/beaglebaseimage
    image_tag: "1.3"
    pull: true                              #required, false if image already built or pulled in pre_ci
    #options:
    #env:

  # build a container as part of workflow
  #pre_ci:
  #  - docker build -t jacopochevallard/hello_world:1.0 .

  ci:
    - rm -rf $CMAKE_MACROS
    - git clone https://github.com/jacopo-chevallard/cmake-macros.git $CMAKE_MACROS
    - mkdir -p build
    - cd build
    - cmake -DCMAKE_Fortran_COMPILER=/usr/bin/gfortran -DCMAKE_INSTALL_PREFIX=$INSTALL_DIR  -DCMAKE_NO_DEFAULT_PATH=TRUE ..
    - make install
    #- ./hello_world
    
  post_ci:
    - cd $HOME

    # If the commit is tagged, then proceed to build the Docker container
    #- if [ "$IS_RELEASE" == "true" ] ; then docker build -t jacopochevallard/hello_world:$RELEASE_NAME -f $SHIPPABLE_BUILD_DIR/Dockerfile ; fi
    - if [ "$IS_GIT_TAG" == "true" ] ; then docker build -t jacopochevallard/hello_world:$GIT_TAG_NAME -f $SHIPPABLE_BUILD_DIR/Dockerfile . ; fi


    # And push the container to DockerHub
    #- if [ "$IS_RELEASE" == "true" ] ; then docker push jacopochevallard/hello_world:$RELEASE_NAME ; fi
    - if [ "$IS_GIT_TAG" == "true" ] ; then docker push jacopochevallard/hello_world:$GIT_TAG_NAME ; fi

